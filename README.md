# UniSuling - 息で奏でる BLE MIDI ブレスコントローラー 🎶

`UniSuling`は、「息で奏でる、単音の楽器」をコンセプトにした、超シンプルなBLE MIDIブレスコントローラーです。🚀 息の強弱だけで、まるで歌うように音楽表現に集中できます！

## 概要 😮

複雑なキー操作は一切なし！シリコンチューブに息を吹き込むだけで、あらかじめ設定した音を鳴らせます。息の強弱はリアルタイムにMIDIの**チャンネルアフタータッチ**信号に変換され、音量や音色に豊かな表情を加えることが可能です。

心臓部には **ESP32S (NodeMCU)** を採用し、**Bluetooth LE (BLE) MIDI** に対応。Mac, PC, iOS, Androidデバイスにワイヤレスで接続し、DAWやシンセサイザーアプリを自由にコントロールできます！

## ✨ 特徴

  * **ワイヤレス接続** wirelessly 📶: BLE MIDIでケーブルから解放され、自由な演奏スタイルを実現！
  * **超シンプル操作** 💨: 運指は不要！息づかいだけで音楽の世界に没頭できます。
  * **豊かな表現力** 💖: チャンネルアフタータッチで、繊細なニュアンスも思いのまま。
  * **キラッと光る** 💡: 息の強さに応じてオンボードLEDが光り、演奏を視覚的にサポート。
  * **かんたん改造** 🔧: Arduino IDEでMIDIノートや息の感度を自分好みに調整できます。

-----

## 🛠️ 必要なもの (ハードウェア)

| 部品名                 | 型番/仕様                                  | 数量 | 備考                               |
| ---------------------- | ------------------------------------------ | ---- | ---------------------------------- |
| **マイクロコントローラー** | **ESP32-S Dev Module (NodeMCU-32S)** | 1    | これが頭脳です！🧠                 |
| 圧力センサー           | MIS-2503-015G (3.3V ゲージ圧)              | 1    | 息を検知する心臓部！❤️             |
| バイパスコンデンサ     | 0.1μF (104) セラミックコンデンサ            | 1    | センサーを安定させるお守り 🙏       |
| **チューブ** | **内径3mm シリコンチューブ** | 適量 | これが楽器の本体！                 |
| 筐体                   | 透明なプラスチック容器 (タッパーなど) | 1    | 見た目をカッコよく！               |
| 接続線材               | ブレッドボード、ジャンパーワイヤー         | 一式 |                                    |

-----

## 組み立てと配線 🔌

### 配線図

ESP32と圧力センサーを下の図のように接続します。とってもかんたん！

  * **センサー VDD** → ESP32 **GPIO 13** (⚠️ **3V3ピンではなく、GPIO 13に接続します**）
  * **センサー GND** → ESP32 **GND**
  * **センサー VOUT** → ESP32 **GPIO 36** (ADC1\_CH0)
  * **バイパスコンデンサ** → センサーのVDDピンとGNDピンの間に接続

### 組み立て

1.  シリコンチューブの片方を圧力センサーのノズルにしっかりと接続します。
2.  タッパーなどの筐体に、USBポートとチューブを出すための穴を開けます。
3.  配線したESP32とセンサーを筐体内にホットボンドなどで固定したら完成です！🎉

-----

## ソフトウェアのセットアップ 💻

### ✅ 動作確認済みバージョン

このプロジェクトは、以下の特定のバージョンで動作確認をしています。バージョンが異なるとコンパイルできない可能性があるので、ご注意ください！ ⚠️

  * **Arduino IDE**: `2.3.6`
  * **esp32 by Espressif Systems**: `2.0.17`
  * **ESP32-BLE-MIDI**: `0.3.1`
  * **NimBLE-Arduino**: `1.4.3`

### 1\. Arduino IDEの準備

1.  上記のバージョンの[Arduino IDE](https://www.arduino.cc/en/software)をインストールします。
2.  `ファイル > 環境設定`を開き、「追加のボードマネージャのURL」に以下を追加します。
    ```
    https://dl.espressif.com/dl/package_esp32_index.json
    ```
3.  `ツール > ボード > ボードマネージャ`で「esp32」を検索し、**バージョン `2.0.17` を選択して**インストールします。
4.  `ツール > ボード`から`ESP32 Dev Module`を選択します。

### 2\. ライブラリのインストール

`ツール > ライブラリを管理`から、以下の2つのライブラリを**指定のバージョンで**インストールしてください。

  * `ESP32-BLE-MIDI` (バージョン `0.3.1`)
  * `NimBLE-Arduino` (バージョン `1.4.3`)

### 3\. スケッチの書き込み

ソースコードをArduino IDEに貼り付け、ESP-32に書き込みます。

-----

## 使い方 🎵

1.  ESP-32に電源を接続します。
2.  PC/Mac/iOS/AndroidデバイスのBluetooth設定画面を開きます。
3.  `ESP32-Uni-Suling`という名前のデバイスが表示されたら、ペアリング！🤝
4.  DAWやシンセアプリを起動し、MIDI入力に`ESP32-Uni-Suling`を選択します。
5.  さあ、チューブに息を吹き込んで、音楽を奏でましょう！

### 🖥️ Windowsでの利用について

Windows環境、特にGoogle ChromeのWeb MIDI (Tone.jsなど) で直接認識しないことがあります。その場合は、以下のツールを組み合わせることで利用できます。

1.  [**loopMIDI**](https://www.tobias-erichsen.de/software/loopmidi.html): 仮想MIDIポートを作成するツール。
2.  [**MIDIberry**](https://www.google.com/search?q=https://www.microsoft.com/ja-jp/p/midiberry/9n39720h2m01): BLE MIDIデバイスを仮想MIDIポートに接続するツール。

**接続の流れ:** `UniSuling` → `MIDIberry` → `loopMIDI` → `DAW / Chrome`

-----

## 🎨 ソースコードによるカスタマイズ

スケッチの冒頭にある定数をイジって、自分だけの楽器に育てましょう！

```cpp
// --- MIDI設定 ---
const int MIDI_CHANNEL = 1;     // MIDIチャンネル (1-16)
const int MIDI_NOTE = 69;       // ノートナンバー (A4だよ！)
const int NOTE_ON_VELOCITY = 127; // ベロシティは元気いっぱいに固定！

// --- ブレスカーブ・閾値設定 ---
const int NOTE_ON_THRESHOLD_OFFSET = 60;   // 息を認識し始める感度
const int NOTE_OFF_THRESHOLD_OFFSET = 30;  // 息が止まったと判断する感度
const int SENSOR_MAX_VALUE = 700;          // 息の最大パワーの目安
const float AFTERTOUCH_CURVE = 1.0;   // 息の強さのカーブ (小さいほど弱い息に敏感に！)
const int AFTERTOUCH_MIN = 0;
const int AFTERTOUCH_MAX = 127;
```

